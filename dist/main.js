(()=>{"use strict";const t=document.querySelector("body"),e=A("div","","modal"),i=A("div","","overlay");function n(n){n.preventDefault(),d(),t.appendChild(e),t.appendChild(i)}function a(n){n.preventDefault(),e.classList.remove("add"),e.classList.remove("edit"),e.replaceChildren(),t.removeChild(e),t.removeChild(i)}function d(){const t=e.appendChild($("","button","close"));t.appendChild(A("span","Close","visually-hidden")),t.addEventListener("click",(t=>{a(t)}))}function o(t,i,d){const o=$(e.classList.contains("edit")?"":"Save","submit",e.classList.contains("edit")?"save":"");return e.classList.contains("edit")?(i.insertAdjacentElement("afterend",o),o.appendChild(A("span","Save category","visually-hidden"))):i.appendChild(o),o.addEventListener("click",(o=>{if(e.classList.contains("edit")){const t=d,a=i.value;m.map((e=>{e.category===t&&(e.category=a)}));const c=L.indexOf(t);L.splice(c,1,a),e.replaceChildren(),n(o),e.classList.add("edit"),s(),T(h),T(u)}else t.editTodo(title.value,desc.value,dueDate.value,priority.value,category.value),a(o),T(u)})),o}function s(){e.appendChild(A("h2","Edit or delete categories"));const t=e.appendChild(document.createElement("ul"));L.map((i=>{const a=t.appendChild(document.createElement("li")),d=a.appendChild(A("h3",`${i}`));d.setAttribute("tabindex","0"),d.setAttribute("type","button"),d.addEventListener("click",(t=>{a.replaceChildren(),a.classList.add("edit-category-modal"),function(t,e,i){const n=e.textContent;t.target.remove();const a=A("label",n,"visually-hidden");a.setAttribute("for",n);const d=document.createElement("input");d.type="text",d.setAttribute("id",n),d.value=n,i.appendChild(a),i.appendChild(d)}(t,d,a);const c=document.querySelector(`#${i}`);!function(t){const i=$("","button","");i.appendChild(A("span","Undo edit category","visually-hidden")),t.insertAdjacentElement("afterend",i),i.addEventListener("click",(t=>{e.replaceChildren(),n(t),e.classList.add("edit"),s()}))}(o(L,c,i))})),C(a,i)}));const i=A("p","Deleting a category deletes all the todos associated with the category!");t.insertAdjacentElement("afterend",i)}const c=document.querySelector(".new-todo"),l=document.querySelector(".new-category"),r=document.querySelector(".todo-container"),u=document.querySelector(".todo-container ul"),p=document.querySelector(".edit-category"),h=document.querySelector(".categories");function y(){document.querySelectorAll(".categories button").forEach((t=>t.classList.remove("active")))}function v(){const t=h.appendChild($("All projects","button","active"));t.addEventListener("click",(()=>{r.classList.remove("filtered"),y(),t.classList.add("active"),T(u)})),L.map((t=>{h.appendChild($(`${t}`,"button","")).addEventListener("click",(t=>{g=m.filter((e=>e.category===t.target.textContent)),y(),r.classList.add("filtered"),t.target.classList.add("active"),T(u)}))}))}function f(t){const i=document.createElement("li");u.appendChild(i);const a=document.createElement("input");a.setAttribute("type","checkbox"),i.appendChild(a),a.checked=t.status,a.checked&&i.setAttribute("class","checked"),a.addEventListener("change",(()=>{!function(t,e=(r.classList.contains("filtered")?g:m)){t.toggleStatus(),e.splice(e.indexOf(t),1),t.status?e.push(t):e.unshift(t)}(t),T(u)}));const o=i.appendChild(A("span",`${t.priority}`,"priority-tag"));o.setAttribute("aria-label","priority"),o.classList.add(t.priority.toLowerCase());const s=i.appendChild(A("h2",`${t.title}`));s.setAttribute("tabindex","0"),s.setAttribute("type","button"),s.setAttribute("aria-label",`See and edit ${t.title}`),i.appendChild(A("span",`${t.dueDate.toLocaleString().split(",")[0]}`)),C(i,t),s.addEventListener("click",(i=>{n(i),function(t){var i;e.appendChild(A("h2",`${t.title}`)),e.appendChild(A("p",`${t.desc}`)),e.appendChild(A("p",`Due Date: ${t.dueDate.toLocaleString().split(",")[0]}`)),e.appendChild(A("p",`Priority: ${t.priority}`)),e.appendChild(A("p",`Category: ${t.category}`)),i=t,e.appendChild($("Edit Todo","button","")).addEventListener("click",(()=>{e.replaceChildren(),d(),S(i),function(t){title.value=t.title,desc.value=t.desc,priority.value=t.priority,category.value=t.category,dueDate.valueAsDate=t.dueDate}(i)}))}(t)}))}function C(t,i){const n=t.appendChild($("","button",""));n.appendChild(A("span",`Delete ${i.title||i}`,"visually-hidden")),n.addEventListener("click",(function(){!function(t,i,n){if(t.remove(),n.splice(n.indexOf(i),1),e.classList.contains("edit")){const t=m.filter((t=>t.category===i));for(let e=0;e<t.length;e++)m=m.filter((i=>i!==t[e]));T(u),T(h)}}(t,i,e.classList.contains("edit")?L:m)}))}c.addEventListener("click",(t=>{e.classList.add("add"),n(t),S()})),l.addEventListener("click",(t=>{n(t),function(){e.appendChild(A("h2","Add a New Category"));const t=e.appendChild(document.createElement("form"));w("New Category","new-category","visually-hidden","input","text",t),function(t){t.appendChild($("Add Category","submit","")).addEventListener("click",(t=>{var e;t.preventDefault(),e=document.querySelector("#new-category").value,L.push(e),a(t),T(h)}))}(t)}()})),p.addEventListener("click",(t=>{n(t),e.classList.add("edit"),s()}));let m=[],g=[],L=["Personal","Work"];const b=["None","Low","Medium","High"];class E{constructor(t,e,i,n,a){this.title=t,this.desc=e,this.dueDate=i?new Date(i):"No Due Date",this.priority=n,this.category=a,this.status=!1}toggleStatus(){return this.status=!this.status,this.status}editTodo(t,e,i,n,a){this.title=t,this.desc=e,this.dueDate=i?new Date(i):"No Due Date",this.priority=n,this.category=a}}function D(t,e,i,n,a){const d=new E(t,e,i,n,a);return m.push(d),d}const k=new Date;function A(t,e,i){const n=document.createElement(t);return n.textContent=e,n.classList.add(i),n}function w(t,e,i,n,a,d){const o=d.appendChild(A("label",t));o.setAttribute("for",e),o.setAttribute("class",i);const s=document.createElement(n);s.setAttribute("type",a),s.id=e,d.appendChild(s)}function S(t){e.appendChild(A("h2",e.classList.contains("add")?"Add a New Todo":"Edit Todo"));const i=e.appendChild(A("form"));w("Todo Title","title","","input","text",i),w("Description","desc","","textarea","",i),w("Due Date","dueDate","","input","date",i),w("Priority","priority","","select","",i),w("Category","category","","select","",i),x(b,"#priority"),x(L,"#category"),e.classList.contains("add")?function(t){t.appendChild($("Add Todo","submit","")).addEventListener("click",(t=>{t.preventDefault(),D(title.value,desc.value,dueDate.value,priority.value,category.value),T(u),a(t)}))}(i):o(t,i)}function x(t,e){t.map((t=>{const i=document.createElement("option"),n=document.querySelector(e);i.textContent=`${t}`,i.value=`${t}`,n.appendChild(i)}))}function $(t,e,i){const n=document.createElement("button");return n.textContent=t,n.setAttribute("type",e),n.setAttribute("class",i),n}function q(t=(r.classList.contains("filtered")?g:m)){!function(t){t.sort(((t,e)=>t.dueDate===e.dueDate&&!0!==t.status&&!0!==e.status?0:t.dueDate>e.dueDate&&!0!==t.status&&!0!==e.status?1:-1))}(t),t.map((t=>f(t)))}function T(t){t.replaceChildren(),t===h?v():q()}D("Click on todo title to see it and edit it","This is the description of the todo. Try to edit this todo clicking the 'Edit todo' button",k,"High","Personal"),D("Click on the X button to delete it","If you delete a todo it is gone forever!",k,"High","Personal"),D("How to navigate the interface","On the top of the page you have buttons to add a new todo, add a new category and edit categories. With the buttons in the next row you can filter your todos from different categories.",k,"High","Personal"),D("Click on the checkbox to mark a todo done","Congratulations, you finished this tutorial!",k,"High","Personal"),q(),v()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDM0MsTUFBTXRELEVBQVNuRSxTQUFTOEMsY0FBYyxVQUl0QyxPQUhBcUIsRUFBT2pCLFlBQWNzRSxFQUNyQnJELEVBQU9sQixhQUFhLE9BQVFLLEdBQzVCYSxFQUFPbEIsYUFBYSxRQUFTd0UsR0FDdEJ0RCxDQUNYLENBRU8sU0FBU3VELEVBQVl2RyxHQUFRMkMsRUFBY25ELFVBQVVZLFNBQVMsWUFBYytDLEVBQWdCMUMsS0R2QzVGLFNBQW1CVCxHQUN0QkEsRUFBTXdHLE1BQUssQ0FBQ0MsRUFBR0MsSUFDTkQsRUFBRWhGLFVBQVlpRixFQUFFakYsVUFBeUIsSUFBYmdGLEVBQUVoRCxTQUFnQyxJQUFiaUQsRUFBRWpELE9BQzdDLEVBQ0NnRCxFQUFFaEYsUUFBVWlGLEVBQUVqRixVQUF5QixJQUFiZ0YsRUFBRWhELFNBQWdDLElBQWJpRCxFQUFFakQsT0FDbEQsR0FFQyxHQUlwQixDQzZCSWtELENBQVUzRyxHQUNWQSxFQUFNVSxLQUFJVCxHQUFXb0QsRUFBZ0JwRCxJQUN6QyxDQUVPLFNBQVNrQixFQUFXbEIsR0FDdkJBLEVBQVFQLGtCQUNSTyxJQUFZbUIsRUFBaUI2QixJQUF3QnNELEdBQ3pELENEakJBakIsRUFBZSw0Q0FBNkMsNkZBQThGQyxFQUFNLE9BQVEsWUFDeEtELEVBQWUscUNBQXNDLDJDQUE0Q0MsRUFBTSxPQUFRLFlBQy9HRCxFQUFlLGdDQUFpQywyTEFBNExDLEVBQU0sT0FBUSxZQUMxUEQsRUFBZSw0Q0FBNkMsK0NBQWdEQyxFQUFNLE9BQVEsWUVoRTFIZ0IsSUFDQXRELEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90by1kby1saXN0Ly4vc3JjL21vZHVsZXMvbW9kYWxET00uanMiLCJ3ZWJwYWNrOi8vdG8tZG8tbGlzdC8uL3NyYy9tb2R1bGVzL3BhZ2VET00uanMiLCJ3ZWJwYWNrOi8vdG8tZG8tbGlzdC8uL3NyYy9tb2R1bGVzL2FwcC5qcyIsIndlYnBhY2s6Ly90by1kby1saXN0Ly4vc3JjL21vZHVsZXMvaGVscGVycy5qcyIsIndlYnBhY2s6Ly90by1kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFkZFRvZG90b0FycmF5LCB0b2RvcywgY2F0ZWdvcmllcywgYWRkTmV3Q2F0ZWdvcnkgfSBmcm9tIFwiLi9hcHBcIjtcbmltcG9ydCB7IGNyZWF0ZURPTUVsZW1lbnQsIGNyZWF0ZUJ1dHRvbiwgY3JlYXRlRm9ybSwgcHJpbnRFeGlzdGVudElucHV0cywgdXBkYXRlUGFnZSB9IGZyb20gXCIuL2hlbHBlcnNcIjtcbmltcG9ydCB7IGNyZWF0ZVJlbW92ZUJ0biwgdWwsIGNhdGVnb3JpZXNIVE1MIH0gZnJvbSBcIi4vcGFnZURPTVwiO1xuXG5jb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XG5leHBvcnQgY29uc3QgbW9kYWwgPSBjcmVhdGVET01FbGVtZW50KFwiZGl2XCIsIFwiXCIsIFwibW9kYWxcIik7XG5jb25zdCBvdmVybGF5ID0gY3JlYXRlRE9NRWxlbWVudChcImRpdlwiLCBcIlwiLCBcIm92ZXJsYXlcIik7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUb2RvQ2FyZChuZXdUb2RvKSB7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQoY3JlYXRlRE9NRWxlbWVudChcImgyXCIsIGAke25ld1RvZG8udGl0bGV9YCkpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKGNyZWF0ZURPTUVsZW1lbnQoXCJwXCIsIGAke25ld1RvZG8uZGVzY31gKSk7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQoY3JlYXRlRE9NRWxlbWVudChcInBcIiwgYER1ZSBEYXRlOiAkeyhuZXdUb2RvLmR1ZURhdGUpLnRvTG9jYWxlU3RyaW5nKCkuc3BsaXQoJywnKVswXX1gKSk7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQoY3JlYXRlRE9NRWxlbWVudChcInBcIiwgYFByaW9yaXR5OiAke25ld1RvZG8ucHJpb3JpdHl9YCkpO1xuICAgIG1vZGFsLmFwcGVuZENoaWxkKGNyZWF0ZURPTUVsZW1lbnQoXCJwXCIsIGBDYXRlZ29yeTogJHtuZXdUb2RvLmNhdGVnb3J5fWApKTtcbiAgICBjcmVhdGVFZGl0QnRuKG5ld1RvZG8pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb3BlbkRpYWxvZyhldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY3JlYXRlQ2xvc2VCdG4oKTtcbiAgICBib2R5LmFwcGVuZENoaWxkKG1vZGFsKTtcbiAgICBib2R5LmFwcGVuZENoaWxkKG92ZXJsYXkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VEaWFsb2coZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJhZGRcIik7XG4gICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcImVkaXRcIik7XG4gICAgbW9kYWwucmVwbGFjZUNoaWxkcmVuKCk7XG4gICAgYm9keS5yZW1vdmVDaGlsZChtb2RhbCk7XG4gICAgYm9keS5yZW1vdmVDaGlsZChvdmVybGF5KTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlQ2xvc2VCdG4oKSB7XG4gICAgY29uc3QgY2xvc2VCdG4gPSBtb2RhbC5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24oXCJcIiwgXCJidXR0b25cIiwgXCJjbG9zZVwiKSk7XG5cbiAgICBjbG9zZUJ0bi5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwic3BhblwiLCBcIkNsb3NlXCIsIFwidmlzdWFsbHktaGlkZGVuXCIpKTtcbiAgICBjbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZXZlbnQgPT4geyBjbG9zZURpYWxvZyhldmVudCkgfSk7XG59XG5cbi8vTW9kYWwncyBidXR0b25zIGZvciB0b2Rvc1xuXG5mdW5jdGlvbiBjcmVhdGVFZGl0QnRuKHRvZG8pIHtcbiAgICBjb25zdCBlZGl0QnRuID0gbW9kYWwuYXBwZW5kQ2hpbGQoY3JlYXRlQnV0dG9uKFwiRWRpdCBUb2RvXCIsIFwiYnV0dG9uXCIsIFwiXCIpKTtcbiAgICBlZGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIG1vZGFsLnJlcGxhY2VDaGlsZHJlbigpO1xuICAgICAgICBjcmVhdGVDbG9zZUJ0bigpO1xuICAgICAgICBjcmVhdGVGb3JtKHRvZG8pO1xuICAgICAgICBwcmludEV4aXN0ZW50SW5wdXRzKHRvZG8pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQWRkQnRuKGZvcm0pIHtcbiAgICBjb25zdCBhZGRUb2RvQnRuID0gZm9ybS5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24oXCJBZGQgVG9kb1wiLCBcInN1Ym1pdFwiLCBcIlwiKSk7XG5cbiAgICBhZGRUb2RvQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldmVudCA9PiB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGFkZFRvZG90b0FycmF5KHRpdGxlLnZhbHVlLCBkZXNjLnZhbHVlLCBkdWVEYXRlLnZhbHVlLCBwcmlvcml0eS52YWx1ZSwgY2F0ZWdvcnkudmFsdWUpO1xuICAgICAgICB1cGRhdGVQYWdlKHVsKTtcbiAgICAgICAgY2xvc2VEaWFsb2coZXZlbnQpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2F2ZUJ0bihhcnJheSwgZWxlbWVudCwgY2F0KSB7XG4gICAgY29uc3Qgc2F2ZUJ0biA9IGNyZWF0ZUJ1dHRvbihtb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoXCJlZGl0XCIpID8gXCJcIiA6IFwiU2F2ZVwiLCBcInN1Ym1pdFwiLCBtb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoXCJlZGl0XCIpID8gXCJzYXZlXCIgOiBcIlwiKTtcblxuICAgIGlmIChtb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoXCJlZGl0XCIpKSB7XG4gICAgICAgIGVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KFwiYWZ0ZXJlbmRcIiwgc2F2ZUJ0bik7XG4gICAgICAgIHNhdmVCdG4uYXBwZW5kQ2hpbGQoY3JlYXRlRE9NRWxlbWVudChcInNwYW5cIiwgXCJTYXZlIGNhdGVnb3J5XCIsIFwidmlzdWFsbHktaGlkZGVuXCIpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKHNhdmVCdG4pO1xuICAgIH1cblxuICAgIHNhdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ZW50ID0+IHtcbiAgICAgICAgaWYgKG1vZGFsLmNsYXNzTGlzdC5jb250YWlucyhcImVkaXRcIikpIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZENhdCA9IGNhdDtcblxuICAgICAgICAgICAgY29uc3QgdXBkYXRlZENhdCA9IGVsZW1lbnQudmFsdWU7XG5cbiAgICAgICAgICAgIHRvZG9zLm1hcCh0b2RvID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodG9kby5jYXRlZ29yeSA9PT0gb2xkQ2F0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRvZG8uY2F0ZWdvcnkgPSB1cGRhdGVkQ2F0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBjb25zdCBpbmRleENhdCA9IGNhdGVnb3JpZXMuaW5kZXhPZihvbGRDYXQpO1xuICAgICAgICAgICAgY2F0ZWdvcmllcy5zcGxpY2UoaW5kZXhDYXQsIDEsIHVwZGF0ZWRDYXQpO1xuXG4gICAgICAgICAgICBtb2RhbC5yZXBsYWNlQ2hpbGRyZW4oKTtcbiAgICAgICAgICAgIG9wZW5EaWFsb2coZXZlbnQpO1xuICAgICAgICAgICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcImVkaXRcIik7XG4gICAgICAgICAgICBzaG93Q2F0ZWdvcmllc01vZGFsKCk7XG4gICAgICAgICAgICB1cGRhdGVQYWdlKGNhdGVnb3JpZXNIVE1MKTtcbiAgICAgICAgICAgIHVwZGF0ZVBhZ2UodWwpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXJyYXkuZWRpdFRvZG8odGl0bGUudmFsdWUsIGRlc2MudmFsdWUsIGR1ZURhdGUudmFsdWUsIHByaW9yaXR5LnZhbHVlLCBjYXRlZ29yeS52YWx1ZSk7XG4gICAgICAgICAgICBjbG9zZURpYWxvZyhldmVudCk7XG4gICAgICAgICAgICB1cGRhdGVQYWdlKHVsKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBzYXZlQnRuO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hvd0NhdGVnb3JpZXNNb2RhbCgpIHtcbiAgICBtb2RhbC5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwiaDJcIiwgXCJFZGl0IG9yIGRlbGV0ZSBjYXRlZ29yaWVzXCIpKTtcbiAgICBjb25zdCB1bCA9IG1vZGFsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ1bFwiKSk7XG5cbiAgICBjYXRlZ29yaWVzLm1hcChjYXRlZ29yeSA9PiB7XG4gICAgICAgIGNvbnN0IGxpID0gdWwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpKTtcbiAgICAgICAgY29uc3QgaDMgPSBsaS5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwiaDNcIiwgYCR7Y2F0ZWdvcnl9YCkpO1xuICAgICAgICBoMy5zZXRBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiLCBcIjBcIik7XG4gICAgICAgIGgzLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJidXR0b25cIik7XG4gICAgICAgIGgzLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldmVudCA9PiB7XG4gICAgICAgICAgICBsaS5yZXBsYWNlQ2hpbGRyZW4oKTtcbiAgICAgICAgICAgIGxpLmNsYXNzTGlzdC5hZGQoXCJlZGl0LWNhdGVnb3J5LW1vZGFsXCIpO1xuICAgICAgICAgICAgdHJhbnNmb3JtQ2F0VG9JbnB1dChldmVudCwgaDMsIGxpKTtcbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgIyR7Y2F0ZWdvcnl9YCk7XG4gICAgICAgICAgICBjb25zdCBzYXZlQnRuID0gY3JlYXRlU2F2ZUJ0bihjYXRlZ29yaWVzLCBpbnB1dCwgY2F0ZWdvcnkpO1xuICAgICAgICAgICAgY3JlYXRlVW5kb0J0bihzYXZlQnRuKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGNyZWF0ZVJlbW92ZUJ0bihsaSwgY2F0ZWdvcnkpO1xuICAgIH0pO1xuICAgIGNvbnN0IHAgPSBjcmVhdGVET01FbGVtZW50KFwicFwiLCBcIkRlbGV0aW5nIGEgY2F0ZWdvcnkgZGVsZXRlcyBhbGwgdGhlIHRvZG9zIGFzc29jaWF0ZWQgd2l0aCB0aGUgY2F0ZWdvcnkhXCIpO1xuICAgIHVsLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJlbmQnLCBwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU5ld0NhdGVnb3J5QnRuKGZvcm0pIHtcbiAgICBjb25zdCBhZGRDYXRCdG4gPSBmb3JtLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbihcIkFkZCBDYXRlZ29yeVwiLCBcInN1Ym1pdFwiLCBcIlwiKSk7XG5cbiAgICBhZGRDYXRCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ZW50ID0+IHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYWRkTmV3Q2F0ZWdvcnkoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctY2F0ZWdvcnlcIikudmFsdWUpO1xuICAgICAgICBjbG9zZURpYWxvZyhldmVudCk7XG4gICAgICAgIHVwZGF0ZVBhZ2UoY2F0ZWdvcmllc0hUTUwpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVVbmRvQnRuKGVsZW1lbnQpIHtcbiAgICBjb25zdCB1bmRvQnRuID0gY3JlYXRlQnV0dG9uKFwiXCIsIFwiYnV0dG9uXCIsIFwiXCIpO1xuICAgIHVuZG9CdG4uYXBwZW5kQ2hpbGQoY3JlYXRlRE9NRWxlbWVudChcInNwYW5cIiwgYFVuZG8gZWRpdCBjYXRlZ29yeWAsIFwidmlzdWFsbHktaGlkZGVuXCIpKTtcbiAgICBlbGVtZW50Lmluc2VydEFkamFjZW50RWxlbWVudChcImFmdGVyZW5kXCIsIHVuZG9CdG4pO1xuXG4gICAgdW5kb0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZXZlbnQgPT4ge1xuICAgICAgICBtb2RhbC5yZXBsYWNlQ2hpbGRyZW4oKTtcbiAgICAgICAgb3BlbkRpYWxvZyhldmVudCk7XG4gICAgICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJlZGl0XCIpO1xuICAgICAgICBzaG93Q2F0ZWdvcmllc01vZGFsKCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybUNhdFRvSW5wdXQoZXZlbnQsIGgzLCBsaSkge1xuICAgIGNvbnN0IHRpdGxlID0gaDMudGV4dENvbnRlbnQ7XG4gICAgZXZlbnQudGFyZ2V0LnJlbW92ZSgpO1xuXG4gICAgY29uc3QgbGFiZWwgPSBjcmVhdGVET01FbGVtZW50KFwibGFiZWxcIiwgdGl0bGUsIFwidmlzdWFsbHktaGlkZGVuXCIsKTtcbiAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgdGl0bGUpO1xuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgIGlucHV0LnR5cGUgPSBcInRleHRcIjtcbiAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJpZFwiLCB0aXRsZSk7XG4gICAgaW5wdXQudmFsdWUgPSB0aXRsZTtcblxuICAgIGxpLmFwcGVuZENoaWxkKGxhYmVsKTtcbiAgICBsaS5hcHBlbmRDaGlsZChpbnB1dCk7XG59IiwiaW1wb3J0IHsgdG9kb3MsIGNhdGVnb3JpZXMsIGZpbHRlcmVkVG9kb3MsIHRvZ2dsZVRvZG8gfSBmcm9tIFwiLi9hcHBcIjtcbmltcG9ydCB7IGNyZWF0ZUJ1dHRvbiwgdXBkYXRlUGFnZSwgY3JlYXRlRE9NRWxlbWVudCwgY3JlYXRlRm9ybSwgY3JlYXRlRm9ybUFkZENhdGVnb3J5LCByZW1vdmVFbGVtZW50IH0gZnJvbSBcIi4vaGVscGVyc1wiO1xuaW1wb3J0IHsgbW9kYWwsIG9wZW5EaWFsb2csIGNyZWF0ZVRvZG9DYXJkLCBzaG93Q2F0ZWdvcmllc01vZGFsIH0gZnJvbSBcIi4vbW9kYWxET01cIjtcblxuY29uc3QgbmV3VG9kb2J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubmV3LXRvZG9cIik7XG5jb25zdCBuZXdDYXRidG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm5ldy1jYXRlZ29yeVwiKTtcbmV4cG9ydCBjb25zdCB0b2RvQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi50b2RvLWNvbnRhaW5lclwiKTtcbmV4cG9ydCBjb25zdCB1bCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIudG9kby1jb250YWluZXIgdWxcIik7XG5jb25zdCBlZGl0Q2F0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5lZGl0LWNhdGVnb3J5XCIpO1xuZXhwb3J0IGNvbnN0IGNhdGVnb3JpZXNIVE1MID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXRlZ29yaWVzXCIpO1xuXG5mdW5jdGlvbiByZXNldEFjdGl2ZVN0YXRlKCkge1xuICAgIGNvbnN0IGJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmNhdGVnb3JpZXMgYnV0dG9uXCIpO1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIikpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ2F0ZWdvcmllc0J0bigpIHtcbiAgICBjb25zdCBhbGxQcm9qZWN0cyA9IGNhdGVnb3JpZXNIVE1MLmFwcGVuZENoaWxkKGNyZWF0ZUJ1dHRvbihcIkFsbCBwcm9qZWN0c1wiLCBcImJ1dHRvblwiLCBcImFjdGl2ZVwiKSk7XG5cbiAgICBhbGxQcm9qZWN0cy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICB0b2RvQ29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoXCJmaWx0ZXJlZFwiKTtcbiAgICAgICAgcmVzZXRBY3RpdmVTdGF0ZSgpO1xuICAgICAgICBhbGxQcm9qZWN0cy5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgICB1cGRhdGVQYWdlKHVsKTtcbiAgICB9KVxuXG4gICAgY2F0ZWdvcmllcy5tYXAoY2F0ZWdvcnkgPT4ge1xuICAgICAgICBjb25zdCBjYXRCdG4gPSBjYXRlZ29yaWVzSFRNTC5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24oYCR7Y2F0ZWdvcnl9YCwgXCJidXR0b25cIiwgXCJcIikpO1xuXG4gICAgICAgIGNhdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZXZlbnQgPT4ge1xuICAgICAgICAgICAgZmlsdGVyZWRUb2RvcyA9IHRvZG9zLmZpbHRlcih0b2RvID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdG9kby5jYXRlZ29yeSA9PT0gZXZlbnQudGFyZ2V0LnRleHRDb250ZW50O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXNldEFjdGl2ZVN0YXRlKCk7XG4gICAgICAgICAgICB0b2RvQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoXCJmaWx0ZXJlZFwiKTtcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuYWRkKFwiYWN0aXZlXCIpO1xuICAgICAgICAgICAgdXBkYXRlUGFnZSh1bCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZW5kZXJUb2Rvc1BhZ2UobmV3VG9kbykge1xuICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImxpXCIpO1xuICAgIHVsLmFwcGVuZENoaWxkKGxpKTtcblxuICAgIGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICAgIGNoZWNrYm94LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJjaGVja2JveFwiKTtcbiAgICBsaS5hcHBlbmRDaGlsZChjaGVja2JveCk7XG5cbiAgICBjaGVja2JveC5jaGVja2VkID0gbmV3VG9kby5zdGF0dXM7XG5cbiAgICBpZiAoY2hlY2tib3guY2hlY2tlZCkge1xuICAgICAgICBsaS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcImNoZWNrZWRcIik7XG4gICAgfVxuXG4gICAgY2hlY2tib3guYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoKSA9PiB7XG4gICAgICAgIHRvZ2dsZVRvZG8obmV3VG9kbyk7XG4gICAgICAgIHVwZGF0ZVBhZ2UodWwpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgcHJpb3JpdHlUYWcgPSBsaS5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwic3BhblwiLCBgJHtuZXdUb2RvLnByaW9yaXR5fWAsIFwicHJpb3JpdHktdGFnXCIpKTtcbiAgICBwcmlvcml0eVRhZy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwicHJpb3JpdHlcIik7XG4gICAgcHJpb3JpdHlUYWcuY2xhc3NMaXN0LmFkZChuZXdUb2RvLnByaW9yaXR5LnRvTG93ZXJDYXNlKCkpO1xuXG4gICAgY29uc3QgaDIgPSBsaS5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwiaDJcIiwgYCR7bmV3VG9kby50aXRsZX1gKSk7XG4gICAgaDIuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgXCIwXCIpO1xuICAgIGgyLnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJidXR0b25cIik7XG4gICAgaDIuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCBgU2VlIGFuZCBlZGl0ICR7bmV3VG9kby50aXRsZX1gKTtcblxuICAgIGxpLmFwcGVuZENoaWxkKGNyZWF0ZURPTUVsZW1lbnQoXCJzcGFuXCIsIGAkeyhuZXdUb2RvLmR1ZURhdGUpLnRvTG9jYWxlU3RyaW5nKCkuc3BsaXQoJywnKVswXX1gKSk7XG4gICAgY3JlYXRlUmVtb3ZlQnRuKGxpLCBuZXdUb2RvKTtcblxuICAgIGgyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldmVudCA9PiB7IG9wZW5EaWFsb2coZXZlbnQpLCBjcmVhdGVUb2RvQ2FyZChuZXdUb2RvKSB9KTtcbn1cblxuLy9CdXR0b25zIG9uIHBhZ2Vcbm5ld1RvZG9idG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ZW50ID0+IHtcbiAgICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwiYWRkXCIpO1xuICAgIG9wZW5EaWFsb2coZXZlbnQpO1xuICAgIGNyZWF0ZUZvcm0oKTtcbn0pO1xuXG5uZXdDYXRidG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGV2ZW50ID0+IHtcbiAgICBvcGVuRGlhbG9nKGV2ZW50KTtcbiAgICBjcmVhdGVGb3JtQWRkQ2F0ZWdvcnkoKTtcbn0pO1xuXG5lZGl0Q2F0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBldmVudCA9PiB7XG4gICAgb3BlbkRpYWxvZyhldmVudCk7XG4gICAgbW9kYWwuY2xhc3NMaXN0LmFkZChcImVkaXRcIik7XG4gICAgc2hvd0NhdGVnb3JpZXNNb2RhbCgpO1xufSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZW1vdmVCdG4obGksIGVsZW1lbnQpIHtcbiAgICBjb25zdCByZW1vdmVCdG4gPSBsaS5hcHBlbmRDaGlsZChjcmVhdGVCdXR0b24oXCJcIiwgXCJidXR0b25cIiwgXCJcIikpO1xuICAgIHJlbW92ZUJ0bi5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwic3BhblwiLCBgRGVsZXRlICR7ZWxlbWVudC50aXRsZSB8fCBlbGVtZW50fWAsIFwidmlzdWFsbHktaGlkZGVuXCIpKTtcblxuICAgIHJlbW92ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICByZW1vdmVFbGVtZW50KGxpLCBlbGVtZW50LCBtb2RhbC5jbGFzc0xpc3QuY29udGFpbnMoXCJlZGl0XCIpID8gY2F0ZWdvcmllcyA6IHRvZG9zKTtcbiAgICB9KTtcbn0iLCJpbXBvcnQgeyB0b2RvQ29udGFpbmVyIH0gZnJvbSBcIi4vcGFnZURPTVwiO1xuXG5leHBvcnQgbGV0IHRvZG9zID0gW107XG5leHBvcnQgbGV0IGZpbHRlcmVkVG9kb3MgPSBbXTtcbmV4cG9ydCBsZXQgY2F0ZWdvcmllcyA9IFtcIlBlcnNvbmFsXCIsIFwiV29ya1wiXTtcbmV4cG9ydCBjb25zdCBwcmlvcml0ZXMgPSBbXCJOb25lXCIsIFwiTG93XCIsIFwiTWVkaXVtXCIsIFwiSGlnaFwiXTtcbmV4cG9ydCBjbGFzcyBUb2RvIHtcbiAgICBjb25zdHJ1Y3Rvcih0aXRsZSwgZGVzYywgZHVlRGF0ZSwgcHJpb3JpdHksIGNhdGVnb3J5KSB7XG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgdGhpcy5kZXNjID0gZGVzYztcbiAgICAgICAgdGhpcy5kdWVEYXRlID0gZHVlRGF0ZSA/IG5ldyBEYXRlKGR1ZURhdGUpIDogXCJObyBEdWUgRGF0ZVwiO1xuICAgICAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICAgIHRoaXMuY2F0ZWdvcnkgPSBjYXRlZ29yeTtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB0b2dnbGVTdGF0dXMoKSB7XG4gICAgICAgIHRoaXMuc3RhdHVzID0gIXRoaXMuc3RhdHVzO1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0dXM7XG4gICAgfVxuXG4gICAgZWRpdFRvZG8odGl0bGUsIGRlc2MsIGR1ZURhdGUsIHByaW9yaXR5LCBjYXRlZ29yeSkge1xuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgICAgIHRoaXMuZGVzYyA9IGRlc2M7XG4gICAgICAgIHRoaXMuZHVlRGF0ZSA9IGR1ZURhdGUgPyBuZXcgRGF0ZShkdWVEYXRlKSA6IFwiTm8gRHVlIERhdGVcIjtcbiAgICAgICAgdGhpcy5wcmlvcml0eSA9IHByaW9yaXR5O1xuICAgICAgICB0aGlzLmNhdGVnb3J5ID0gY2F0ZWdvcnk7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkVG9kb3RvQXJyYXkodGl0bGUsIGRlc2MsIGR1ZURhdGUsIHByaW9yaXR5LCBjYXRlZ29yeSkge1xuICAgIGNvbnN0IG5ld1RvZG8gPSBuZXcgVG9kbyh0aXRsZSwgZGVzYywgZHVlRGF0ZSwgcHJpb3JpdHksIGNhdGVnb3J5KTtcbiAgICB0b2Rvcy5wdXNoKG5ld1RvZG8pO1xuICAgIHJldHVybiBuZXdUb2RvO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc29ydFRvZG9zKGFycmF5KSB7XG4gICAgYXJyYXkuc29ydCgoYSwgYikgPT4ge1xuICAgICAgICBpZiAoKGEuZHVlRGF0ZSA9PT0gYi5kdWVEYXRlKSAmJiBhLnN0YXR1cyAhPT0gdHJ1ZSAmJiBiLnN0YXR1cyAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH0gZWxzZSBpZiAoKGEuZHVlRGF0ZSA+IGIuZHVlRGF0ZSkgJiYgYS5zdGF0dXMgIT09IHRydWUgJiYgYi5zdGF0dXMgIT09IHRydWUpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGFycmF5O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9nZ2xlVG9kbyh0b2RvLCBhcnJheSA9IHRvZG9Db250YWluZXIuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZmlsdGVyZWRcIikgPyBmaWx0ZXJlZFRvZG9zIDogdG9kb3MpIHtcbiAgICB0b2RvLnRvZ2dsZVN0YXR1cygpO1xuICAgIGFycmF5LnNwbGljZShhcnJheS5pbmRleE9mKHRvZG8pLCAxKTtcbiAgICBpZiAodG9kby5zdGF0dXMpIHtcbiAgICAgICAgYXJyYXkucHVzaCh0b2RvKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBhcnJheS51bnNoaWZ0KHRvZG8pO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZE5ld0NhdGVnb3J5KGNhdCkge1xuICAgIGNhdGVnb3JpZXMucHVzaChjYXQpO1xuICAgIHJldHVybiBjYXRlZ29yaWVzO1xufVxuXG4vL0VsZW1lbnRpIGRpIHByb3ZhXG5jb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbmFkZFRvZG90b0FycmF5KFwiQ2xpY2sgb24gdG9kbyB0aXRsZSB0byBzZWUgaXQgYW5kIGVkaXQgaXRcIiwgXCJUaGlzIGlzIHRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgdG9kby4gVHJ5IHRvIGVkaXQgdGhpcyB0b2RvIGNsaWNraW5nIHRoZSAnRWRpdCB0b2RvJyBidXR0b25cIiwgZGF0ZSwgXCJIaWdoXCIsIFwiUGVyc29uYWxcIik7XG5hZGRUb2RvdG9BcnJheShcIkNsaWNrIG9uIHRoZSBYIGJ1dHRvbiB0byBkZWxldGUgaXRcIiwgXCJJZiB5b3UgZGVsZXRlIGEgdG9kbyBpdCBpcyBnb25lIGZvcmV2ZXIhXCIsIGRhdGUsIFwiSGlnaFwiLCBcIlBlcnNvbmFsXCIpO1xuYWRkVG9kb3RvQXJyYXkoXCJIb3cgdG8gbmF2aWdhdGUgdGhlIGludGVyZmFjZVwiLCBcIk9uIHRoZSB0b3Agb2YgdGhlIHBhZ2UgeW91IGhhdmUgYnV0dG9ucyB0byBhZGQgYSBuZXcgdG9kbywgYWRkIGEgbmV3IGNhdGVnb3J5IGFuZCBlZGl0IGNhdGVnb3JpZXMuIFdpdGggdGhlIGJ1dHRvbnMgaW4gdGhlIG5leHQgcm93IHlvdSBjYW4gZmlsdGVyIHlvdXIgdG9kb3MgZnJvbSBkaWZmZXJlbnQgY2F0ZWdvcmllcy5cIiwgZGF0ZSwgXCJIaWdoXCIsIFwiUGVyc29uYWxcIik7XG5hZGRUb2RvdG9BcnJheShcIkNsaWNrIG9uIHRoZSBjaGVja2JveCB0byBtYXJrIGEgdG9kbyBkb25lXCIsIFwiQ29uZ3JhdHVsYXRpb25zLCB5b3UgZmluaXNoZWQgdGhpcyB0dXRvcmlhbCFcIiwgZGF0ZSwgXCJIaWdoXCIsIFwiUGVyc29uYWxcIik7IiwiaW1wb3J0IHsgdG9kb3MsIGZpbHRlcmVkVG9kb3MsIGNhdGVnb3JpZXMsIHByaW9yaXRlcywgc29ydFRvZG9zIH0gZnJvbSBcIi4vYXBwXCI7XG5pbXBvcnQgeyBjcmVhdGVDYXRlZ29yaWVzQnRuLCByZW5kZXJUb2Rvc1BhZ2UsIGNhdGVnb3JpZXNIVE1MLCB0b2RvQ29udGFpbmVyLCB1bCB9IGZyb20gXCIuL3BhZ2VET01cIjtcbmltcG9ydCB7IG1vZGFsLCBjcmVhdGVBZGRCdG4sIGNyZWF0ZVNhdmVCdG4sIGNyZWF0ZU5ld0NhdGVnb3J5QnRuIH0gZnJvbSBcIi4vbW9kYWxET01cIjtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURPTUVsZW1lbnQoZWwsIGNvbnRlbnQsIGVsQ2xhc3MpIHtcbiAgICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChlbCk7XG4gICAgZWxlbWVudC50ZXh0Q29udGVudCA9IGNvbnRlbnQ7XG4gICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGVsQ2xhc3MpO1xuICAgIHJldHVybiBlbGVtZW50O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRm9ybUVsZW1lbnQodGV4dExhYmVsLCBpZCwgbGFiZWxDbGFzcywgaW5wdXRFbCwgaW5wdXRUeXBlLCBmb3JtKSB7XG4gICAgY29uc3QgbGFiZWwgPSBmb3JtLmFwcGVuZENoaWxkKGNyZWF0ZURPTUVsZW1lbnQoXCJsYWJlbFwiLCB0ZXh0TGFiZWwpKTtcbiAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoXCJmb3JcIiwgaWQpO1xuICAgIGxhYmVsLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIGxhYmVsQ2xhc3MpO1xuXG4gICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGlucHV0RWwpO1xuICAgIGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgaW5wdXRUeXBlKTtcbiAgICBpbnB1dC5pZCA9IGlkO1xuXG4gICAgZm9ybS5hcHBlbmRDaGlsZChpbnB1dCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGb3JtQWRkQ2F0ZWdvcnkoKSB7XG4gICAgbW9kYWwuYXBwZW5kQ2hpbGQoY3JlYXRlRE9NRWxlbWVudChcImgyXCIsIFwiQWRkIGEgTmV3IENhdGVnb3J5XCIpKTtcblxuICAgIGNvbnN0IGZvcm0gPSBtb2RhbC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZm9ybVwiKSk7XG5cbiAgICBjcmVhdGVGb3JtRWxlbWVudChcIk5ldyBDYXRlZ29yeVwiLCBcIm5ldy1jYXRlZ29yeVwiLCBcInZpc3VhbGx5LWhpZGRlblwiLCBcImlucHV0XCIsIFwidGV4dFwiLCBmb3JtKTtcbiAgICBjcmVhdGVOZXdDYXRlZ29yeUJ0bihmb3JtKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVGb3JtKHRvZG8pIHtcbiAgICBtb2RhbC5hcHBlbmRDaGlsZChjcmVhdGVET01FbGVtZW50KFwiaDJcIiwgbW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiYWRkXCIpID8gXCJBZGQgYSBOZXcgVG9kb1wiIDogXCJFZGl0IFRvZG9cIikpO1xuXG4gICAgY29uc3QgZm9ybSA9IG1vZGFsLmFwcGVuZENoaWxkKGNyZWF0ZURPTUVsZW1lbnQoXCJmb3JtXCIpKTtcblxuICAgIGNyZWF0ZUZvcm1FbGVtZW50KFwiVG9kbyBUaXRsZVwiLCBcInRpdGxlXCIsIFwiXCIsIFwiaW5wdXRcIiwgXCJ0ZXh0XCIsIGZvcm0pO1xuICAgIGNyZWF0ZUZvcm1FbGVtZW50KFwiRGVzY3JpcHRpb25cIiwgXCJkZXNjXCIsIFwiXCIsIFwidGV4dGFyZWFcIiwgXCJcIiwgZm9ybSk7XG4gICAgY3JlYXRlRm9ybUVsZW1lbnQoXCJEdWUgRGF0ZVwiLCBcImR1ZURhdGVcIiwgXCJcIiwgXCJpbnB1dFwiLCBcImRhdGVcIiwgZm9ybSk7XG4gICAgY3JlYXRlRm9ybUVsZW1lbnQoXCJQcmlvcml0eVwiLCBcInByaW9yaXR5XCIsIFwiXCIsIFwic2VsZWN0XCIsIFwiXCIsIGZvcm0pO1xuICAgIGNyZWF0ZUZvcm1FbGVtZW50KFwiQ2F0ZWdvcnlcIiwgXCJjYXRlZ29yeVwiLCBcIlwiLCBcInNlbGVjdFwiLCBcIlwiLCBmb3JtKTtcblxuICAgIGxpc3RUb09wdGlvbihwcmlvcml0ZXMsIFwiI3ByaW9yaXR5XCIpO1xuICAgIGxpc3RUb09wdGlvbihjYXRlZ29yaWVzLCBcIiNjYXRlZ29yeVwiKTtcblxuICAgIG1vZGFsLmNsYXNzTGlzdC5jb250YWlucyhcImFkZFwiKSA/IGNyZWF0ZUFkZEJ0bihmb3JtKSA6IGNyZWF0ZVNhdmVCdG4odG9kbywgZm9ybSk7XG59XG5cbmZ1bmN0aW9uIGxpc3RUb09wdGlvbihsaXN0LCBpZCkge1xuICAgIGxpc3QubWFwKGVsZW1lbnQgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xuICAgICAgICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkKTtcbiAgICAgICAgb3B0aW9uLnRleHRDb250ZW50ID0gYCR7ZWxlbWVudH1gO1xuICAgICAgICBvcHRpb24udmFsdWUgPSBgJHtlbGVtZW50fWA7XG4gICAgICAgIHNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xuICAgIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJpbnRFeGlzdGVudElucHV0cyh0b2RvKSB7XG4gICAgdGl0bGUudmFsdWUgPSB0b2RvLnRpdGxlO1xuICAgIGRlc2MudmFsdWUgPSB0b2RvLmRlc2M7XG4gICAgcHJpb3JpdHkudmFsdWUgPSB0b2RvLnByaW9yaXR5O1xuICAgIGNhdGVnb3J5LnZhbHVlID0gdG9kby5jYXRlZ29yeTtcbiAgICBkdWVEYXRlLnZhbHVlQXNEYXRlID0gdG9kby5kdWVEYXRlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQnV0dG9uKHRleHRCdXR0b24sIHR5cGUsIGJ0bkNsYXNzKSB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSB0ZXh0QnV0dG9uO1xuICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIHR5cGUpO1xuICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBidG5DbGFzcyk7XG4gICAgcmV0dXJuIGJ1dHRvbjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlclRvZG9zKGFycmF5ID0gdG9kb0NvbnRhaW5lci5jbGFzc0xpc3QuY29udGFpbnMoXCJmaWx0ZXJlZFwiKSA/IGZpbHRlcmVkVG9kb3MgOiB0b2Rvcykge1xuICAgIHNvcnRUb2RvcyhhcnJheSk7XG4gICAgYXJyYXkubWFwKGVsZW1lbnQgPT4gcmVuZGVyVG9kb3NQYWdlKGVsZW1lbnQpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVBhZ2UoZWxlbWVudCkge1xuICAgIGVsZW1lbnQucmVwbGFjZUNoaWxkcmVuKCk7XG4gICAgZWxlbWVudCA9PT0gY2F0ZWdvcmllc0hUTUwgPyBjcmVhdGVDYXRlZ29yaWVzQnRuKCkgOiByZW5kZXJUb2RvcygpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlRWxlbWVudChsaSwgZWxlbWVudCwgYXJyYXkpIHtcbiAgICBsaS5yZW1vdmUoKTtcbiAgICBhcnJheS5zcGxpY2UoYXJyYXkuaW5kZXhPZihlbGVtZW50KSwgMSk7XG5cbiAgICBpZiAobW9kYWwuY2xhc3NMaXN0LmNvbnRhaW5zKFwiZWRpdFwiKSkge1xuICAgICAgICBjb25zdCB0b2Rvc1dpdGhDYXRlZ29yeSA9IHRvZG9zLmZpbHRlcih0b2RvID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0b2RvLmNhdGVnb3J5ID09PSBlbGVtZW50O1xuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2Rvc1dpdGhDYXRlZ29yeS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdG9kb3MgPSB0b2Rvcy5maWx0ZXIoaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gIT09IHRvZG9zV2l0aENhdGVnb3J5W2ldO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlUGFnZSh1bCk7XG4gICAgICAgIHVwZGF0ZVBhZ2UoY2F0ZWdvcmllc0hUTUwpO1xuICAgIH1cbn0iLCIvL3ZhbGlkYXppb25lIGZvcm0gZSBtZXNzYWdnaSBkaSBjb25mZXJtYVxuaW1wb3J0ICcuL3N0eWxlLmNzcyc7XG5pbXBvcnQgeyByZW5kZXJUb2RvcyB9IGZyb20gXCIuL21vZHVsZXMvaGVscGVyc1wiO1xuaW1wb3J0IHsgY3JlYXRlQ2F0ZWdvcmllc0J0biB9IGZyb20gJy4vbW9kdWxlcy9wYWdlRE9NJztcblxucmVuZGVyVG9kb3MoKTtcbmNyZWF0ZUNhdGVnb3JpZXNCdG4oKTsiXSwibmFtZXMiOlsiYm9keSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1vZGFsIiwiY3JlYXRlRE9NRWxlbWVudCIsIm92ZXJsYXkiLCJvcGVuRGlhbG9nIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsImNyZWF0ZUNsb3NlQnRuIiwiYXBwZW5kQ2hpbGQiLCJjbG9zZURpYWxvZyIsImNsYXNzTGlzdCIsInJlbW92ZSIsInJlcGxhY2VDaGlsZHJlbiIsInJlbW92ZUNoaWxkIiwiY2xvc2VCdG4iLCJjcmVhdGVCdXR0b24iLCJhZGRFdmVudExpc3RlbmVyIiwiY3JlYXRlU2F2ZUJ0biIsImFycmF5IiwiZWxlbWVudCIsImNhdCIsInNhdmVCdG4iLCJjb250YWlucyIsImluc2VydEFkamFjZW50RWxlbWVudCIsIm9sZENhdCIsInVwZGF0ZWRDYXQiLCJ2YWx1ZSIsInRvZG9zIiwibWFwIiwidG9kbyIsImNhdGVnb3J5IiwiaW5kZXhDYXQiLCJjYXRlZ29yaWVzIiwiaW5kZXhPZiIsInNwbGljZSIsImFkZCIsInNob3dDYXRlZ29yaWVzTW9kYWwiLCJ1cGRhdGVQYWdlIiwiY2F0ZWdvcmllc0hUTUwiLCJ1bCIsImVkaXRUb2RvIiwidGl0bGUiLCJkZXNjIiwiZHVlRGF0ZSIsInByaW9yaXR5IiwiY3JlYXRlRWxlbWVudCIsImxpIiwiaDMiLCJzZXRBdHRyaWJ1dGUiLCJ0ZXh0Q29udGVudCIsInRhcmdldCIsImxhYmVsIiwiaW5wdXQiLCJ0eXBlIiwidHJhbnNmb3JtQ2F0VG9JbnB1dCIsInVuZG9CdG4iLCJjcmVhdGVVbmRvQnRuIiwiY3JlYXRlUmVtb3ZlQnRuIiwicCIsIm5ld1RvZG9idG4iLCJuZXdDYXRidG4iLCJ0b2RvQ29udGFpbmVyIiwiZWRpdENhdEJ0biIsInJlc2V0QWN0aXZlU3RhdGUiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImJ1dHRvbiIsImNyZWF0ZUNhdGVnb3JpZXNCdG4iLCJhbGxQcm9qZWN0cyIsImZpbHRlcmVkVG9kb3MiLCJmaWx0ZXIiLCJyZW5kZXJUb2Rvc1BhZ2UiLCJuZXdUb2RvIiwiY2hlY2tib3giLCJjaGVja2VkIiwic3RhdHVzIiwidG9nZ2xlU3RhdHVzIiwicHVzaCIsInVuc2hpZnQiLCJ0b2dnbGVUb2RvIiwicHJpb3JpdHlUYWciLCJ0b0xvd2VyQ2FzZSIsImgyIiwidG9Mb2NhbGVTdHJpbmciLCJzcGxpdCIsImNyZWF0ZUZvcm0iLCJ2YWx1ZUFzRGF0ZSIsInByaW50RXhpc3RlbnRJbnB1dHMiLCJjcmVhdGVUb2RvQ2FyZCIsInJlbW92ZUJ0biIsInRvZG9zV2l0aENhdGVnb3J5IiwiaSIsImxlbmd0aCIsIml0ZW0iLCJyZW1vdmVFbGVtZW50IiwiZm9ybSIsImNyZWF0ZUZvcm1FbGVtZW50IiwiY3JlYXRlTmV3Q2F0ZWdvcnlCdG4iLCJjcmVhdGVGb3JtQWRkQ2F0ZWdvcnkiLCJwcmlvcml0ZXMiLCJUb2RvIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwiRGF0ZSIsImFkZFRvZG90b0FycmF5IiwiZGF0ZSIsImVsIiwiY29udGVudCIsImVsQ2xhc3MiLCJ0ZXh0TGFiZWwiLCJpZCIsImxhYmVsQ2xhc3MiLCJpbnB1dEVsIiwiaW5wdXRUeXBlIiwibGlzdFRvT3B0aW9uIiwiY3JlYXRlQWRkQnRuIiwibGlzdCIsIm9wdGlvbiIsInNlbGVjdCIsInRleHRCdXR0b24iLCJidG5DbGFzcyIsInJlbmRlclRvZG9zIiwic29ydCIsImEiLCJiIiwic29ydFRvZG9zIl0sInNvdXJjZVJvb3QiOiIifQ==